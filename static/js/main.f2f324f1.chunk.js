(this.webpackJsonpnew_react_app=this.webpackJsonpnew_react_app||[]).push([[0],{100:function(e,t,n){},115:function(e,t,n){"use strict";n.r(t);var c,o=n(0),s=n.n(o),a=n(18),r=n.n(a),i=(n(100),n(37)),u=n(20);!function(e){e.sendMessage="send_message",e.connectWebSocket="connect_web_socket"}(c||(c={}));var d=c,l=(n(105),n(26)),m=n.n(l),g=n(11);var f=Object(u.b)(function(e,t){return{messages:e.messages,connected:e.connected,error:e.error,current_id:e.current_id,closed:e.closed,loading:e.loading}},function(e,t){return{sendMessage:function(t){return e(d.sendMessage,t)},connectWebSocket:function(){return e(d.connectWebSocket)}}},function(e,t){return{}},function(e,t){return{}})(function(e){var t=e.messages,n=e.sendMessage,c=e.connected,a=e.connectWebSocket,r=e.current_id,u=e.closed,d=e.loading,l=e.error,f=Object(o.useState)(""),b=Object(i.a)(f,2),p=b[0],v=b[1],h=Object(o.useMemo)(function(){return c?0:d?1:l>0?3:2},[c,d,l]);return 2===h&&a(),s.a.createElement(g.k,{popout:1===h&&s.a.createElement(g.j,null),activePanel:"chat"},s.a.createElement(g.h,{id:"chat"},s.a.createElement(g.i,null,"\u0413\u043b\u0430\u0432\u043d\u044b\u0439 \u0447\u0430\u0442 (",0===h?"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043e":3===h?"Access Denied":"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...",")"),s.a.createElement(g.g,{style:{marginBottom:60}},t.map(function(e,t){return s.a.createElement(g.c,{key:t,asideContent:e.avatar&&e.user_id===r&&s.a.createElement(g.a,{src:e.avatar}),before:e.avatar&&e.user_id!==r&&s.a.createElement(g.a,{src:e.avatar}),description:e.username&&(e.user_id===r&&s.a.createElement("div",{style:{textAlign:"right"}},e.username)||e.username)},e.service&&s.a.createElement("center",null,e.text)||e.user_id===r&&s.a.createElement("div",{style:{textAlign:"right"}},e.text)||e.text)})),s.a.createElement(g.d,{vertical:"bottom"},s.a.createElement(g.e,{style:{margin:0}},s.a.createElement(g.c,{asideContent:s.a.createElement(g.b,{level:"secondary",onClick:function(){return p.length>0&&!u?(n(p),void v("")):""}},s.a.createElement(m.a,null))},s.a.createElement(g.f,Object.assign({alignment:"center",onChange:function(e){return v(e.target.value)},onKeyPress:function(e){return"Enter"===e.key&&p.length>0&&!u?(n(p),void v("")):""}},0!==h&&{disabled:!0},{value:p,placeholder:"\u0412\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})))))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var b,p=n(16),v=n(38),h=n(36),k=n(23);!function(e){e.setConnected="set_connected",e.setDisconnected="set_disconnected",e.setMessages="set_messages",e.appendMessage="append_message",e.setCurrentId="set_current_id",e.setClosedButton="set_closed_button",e.resetConnection="reset_connection"}(b||(b={}));var _,E,w=b,C=n(17),j=n.n(C);h.a.use(k.a);var O=new k.a.Store({state:{messages:[{text:"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0447\u0430\u0442",service:!0}],connected:!1,socket:"",current_id:0,closed:!1,loading:!1,users:[],error:""},getters:{},mutations:(_={},Object(p.a)(_,w.setConnected,function(e,t){e.connected=!0,e.loading=!1,e.socket=t}),Object(p.a)(_,w.appendMessage,function(e,t){e.messages=[].concat(Object(v.a)(e.messages),[t])}),Object(p.a)(_,w.setMessages,function(e,t){e.messages=t}),Object(p.a)(_,w.setCurrentId,function(e,t){e.current_id=t}),Object(p.a)(_,w.setClosedButton,function(e,t){e.closed=t}),Object(p.a)(_,w.resetConnection,function(e){window.onbeforeunload=function(){try{e.socket.onclose=function(){},e.socket.close()}catch(t){}},e.loading=!0,e.connected=!1,e.socket=""}),Object(p.a)(_,w.setDisconnected,function(e,t){e.error=t,e.connected=!1,e.loading=!1}),_),actions:(E={},Object(p.a)(E,d.connectWebSocket,function(e){var t=e.commit,n=e.dispatch;t(w.resetConnection),j.a.sendPromise("VKWebAppGetUserInfo",{}).then(function(e){return t(w.setCurrentId,e.id)});var c=new WebSocket("wss://vkminichat.herokuapp.com/chat".concat(window.location.search));c.onopen=function(e){console.log("\u041e\u0442\u043a\u0440\u044b\u0442\u043e!"),t(w.setConnected,c)},c.onclose=function(e){console.log("\u0417\u0430\u043a\u0440\u044b\u0442\u043e!"),console.log(e),"User is exists"===e.reason?(setTimeout(function(){return n(d.connectWebSocket)},2e3),t(w.setDisconnected,2)):"Validation error"===e.reason?t(w.setDisconnected,1):n(d.connectWebSocket)},c.onmessage=function(e){var n=JSON.parse(e.data);t(w.appendMessage,n)}}),Object(p.a)(E,d.sendMessage,function(e,t){var n=e.state,c=e.commit;c(w.setClosedButton,!0),setTimeout(function(){return c(w.setClosedButton,!1)},1e3),n.socket.send(t)}),E)});j.a.send("VKWebAppInit",{}),r.a.render(s.a.createElement(u.a,{store:O},s.a.createElement(f,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},95:function(e,t,n){e.exports=n(115)}},[[95,1,2]]]);